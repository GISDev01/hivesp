#! /bin/bash

dir=data

if [ -e ${dir}/data1.tsv ] && [ -e ${dir}/query_polygon.tsv ] 
then
    echo "All testing infrastructure is present."
else 
    echo "Test cases are missing... Can't do test without them."
    exit 1
fi

# create the test files.
make -f makefile


# test map contains

echo -n "TEST: Map Contains --- "

cat ${dir}/data1.tsv | ./map_contains "POLYGON((33729 35868, 33729 35867, 33729 35866, 33730 35866, 33730 35865, 33731 35865, 33731 35864, 33732 35864, 33732 35863, 33732 35862, 33733 35862, 33733 35861, 33733 35860, 33734 35860, 33735 35860, 33735 35861, 33735 35862, 33735 35863, 33735 35864, 33736 35864, 33736 35865, 33737 35865, 33737 35866, 33738 35866, 33738 35867, 33738 35868, 33739 35868, 33739 35869, 33738 35869, 33738 35870, 33737 35870, 33736 35870, 33735 35870, 33735 35871, 33734 35871, 33733 35871, 33733 35872, 33732 35872, 33732 35871, 33731 35871, 33731 35870, 33730 35870, 33730 35869, 33729 35869, 33729 35868));POLYGON((33493 35995, 33494 35995, 33494 35994, 33495 35994, 33495 35993, 33496 35993, 33496 35992, 33497 35992, 33497 35991, 33498 35991, 33499 35991, 33500 35991, 33501 35991, 33502 35991, 33503 35991, 33504 35991, 33505 35991, 33505 35992, 33506 35992, 33506 35993, 33507 35993, 33507 35994, 33508 35994, 33508 35995, 33509 35995, 33509 35996, 33510 35996, 33510 35997, 33510 35998, 33511 35998, 33511 35999, 33511 36000, 33510 36000, 33510 36001, 33509 36001, 33509 36002, 33508 36002, 33508 36003, 33507 36003, 33507 36004, 33506 36004, 33506 36005, 33505 36005, 33505 36006, 33504 36006, 33503 36006, 33502 36006, 33502 36005, 33501 36005, 33500 36005, 33499 36005, 33498 36005, 33498 36004, 33497 36004, 33497 36003, 33496 36003, 33496 36002, 33495 36002, 33495 36001, 33494 36001, 33494 36000, 33493 36000, 33493 35999, 33493 35998, 33493 35997, 33493 35996, 33493 35995))" 9 > ${dir}/map_contains_output.tsv

diff ${dir}/map_contains_output.tsv ${dir}/map_contains_standard.tsv >/dev/null 2>&1

if [ $? -ne 0 ]
then
    echo "failed."
else
    echo "passed."
    rm ${dir}/map_contains_output.tsv
fi


make clean
